<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.bqjr.report.mapper.ReportInfoMapper">

	<select id="findAll" resultType="com.bqjr.report.model.Organization">
		select pk_id pkId,parent_id
		parentId,org_name orgName
		from c_sys_organization 
	</select>

	<select id="getOrganizationById" parameterType="string"
		resultType="com.bqjr.report.model.Organization">
		select pk_id pkId,parent_id parentId,org_name orgName
		from
		c_sys_organization where pk_id=#{pkId}
	</select>

	<select id="getInfoByOrganizationId" parameterType="com.bqjr.report.model.OrganizationBean"
		resultType="com.bqjr.report.model.OrganizationVo">
		select cso.pk_id,
		cso.org_name orgName,
		(select sum(fooi.total) from
		finance_org_other_income fooi
		where fooi.org_id = cso.pk_id and
		fooi.status = '1'
		and fooi.delete_flag = '1'
		and last_up_time between
		#{beginDay} and #{endDay}
		group by org_id,org_name) income,
		(select
		sum(fooe.total)
		from finance_org_other_expend fooe
		where fooe.org_id =
		cso.pk_id
		and fooe.status = '1'
		and fooe.delete_flag = '1'
		and last_up_time between #{beginDay} and #{endDay}
		group by org_id,org_name) expend
		from c_sys_organization cso
		where cso.pk_id in
		<foreach collection="list" item="pkIds" open="(" separator=","
			close=")">
			#{pkIds}
		</foreach>
		group by cso.pk_id, cso.org_name
	</select>

	<select id="getIncomeByBusinessType" parameterType="com.bqjr.report.model.OrganizationBean"
		resultType="com.bqjr.report.model.OrganizationVo">
		select org_name orgName,'1' businessType,business_name businessName,sum(total) income
		from finance_org_other_income
		where status = '1'
		and delete_flag = '1'
		<if test="businessType != null and businessType != '' ">
			and business_type = #{businessType}
		</if>
		and last_up_time between #{beginDay} and #{endDay}
		and org_id in
		<foreach collection="list" item="pkIds" open="(" separator=","
			close=")">
			#{pkIds}
		</foreach>
		group by org_id,org_name,business_id,business_name
	</select>
	
	<select id="getExpendByBusinessType" parameterType="com.bqjr.report.model.OrganizationBean"
		resultType="com.bqjr.report.model.OrganizationVo">
		select org_name orgName,'1' businessType,business_name businessName,sum(total) expend
		from finance_org_other_expend
		where status = '1'
		and delete_flag = '1'
		<if test="businessType != null and businessType != '' ">
			and business_type = #{businessType}
		</if>
		and last_up_time between #{beginDay} and #{endDay}
		and org_id in
		<foreach collection="list" item="pkIds" open="(" separator=","
			close=")">
			#{pkIds}
		</foreach>
		group by org_id,org_name,business_id,business_name
	</select>
</mapper>